/**
 * Minified by jsDelivr using Terser v5.39.0.
 * Original file: /npm/chess.js@1.4.0/dist/cjs/chess.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
"use strict";function rootNode(t){return null!==t?{comment:t,variations:[]}:{variations:[]}}function node(t,e,r,i,n){const s={move:t,variations:n};return e&&(s.suffix=e),r&&(s.nag=r),null!==i&&(s.comment=i),s}function lineToTree(...t){const[e,...r]=t;let i=e;for(const t of r)null!==t&&(i.variations=[t,...t.variations],t.variations=[],i=t);return e}function pgn(t,e){if(e.marker&&e.marker.comment){let t=e.root;for(;;){const r=t.variations[0];if(!r){t.comment=e.marker.comment;break}t=r}}return{headers:t,root:e.root,result:(e.marker&&e.marker.result)??void 0}}function peg$subclass(t,e){function r(){this.constructor=t}r.prototype=e.prototype,t.prototype=new r}function peg$SyntaxError(t,e,r,i){var n=Error.call(this,t);return Object.setPrototypeOf&&Object.setPrototypeOf(n,peg$SyntaxError.prototype),n.expected=e,n.found=r,n.location=i,n.name="SyntaxError",n}function peg$padEnd(t,e,r){return r=r||" ",t.length>e?t:(e-=t.length,t+(r+=r.repeat(e)).slice(0,e))}function peg$parse(t,e){var r,i,n,s,o={},a=(e=void 0!==e?e:{}).grammarSource,h={pgn:Wt},l=Wt,u="[",c='"',_="]",f=".",p="O-O-O",g="O-O",d="0-0-0",S="0-0",m="$",E="{",b="}",v=";",A="(",O=")",T="1-0",C="0-1",I="1/2-1/2",k="*",y=/^[a-zA-Z]/,x=/^[^"]/,N=/^[0-9]/,P=/^[.]/,w=/^[a-zA-Z1-8\-=]/,K=/^[+#]/,M=/^[!?]/,L=/^[^}]/,R=/^[^\r\n]/,B=/^[ \t\r\n]/,F=$t("tag pair"),q=Dt("[",!1),D=Dt('"',!1),U=Dt("]",!1),$=$t("tag name"),Q=Ut([["a","z"],["A","Z"]],!1,!1),G=$t("tag value"),H=Ut(['"'],!0,!1),W=$t("move number"),V=Ut([["0","9"]],!1,!1),j=Dt(".",!1),Y=Ut(["."],!1,!1),z=$t("standard algebraic notation"),Z=Dt("O-O-O",!1),J=Dt("O-O",!1),X=Dt("0-0-0",!1),tt=Dt("0-0",!1),et=Ut([["a","z"],["A","Z"],["1","8"],"-","="],!1,!1),rt=Ut(["+","#"],!1,!1),it=$t("suffix annotation"),nt=Ut(["!","?"],!1,!1),st=$t("NAG"),ot=Dt("$",!1),at=$t("brace comment"),ht=Dt("{",!1),lt=Ut(["}"],!0,!1),ut=Dt("}",!1),ct=$t("rest of line comment"),_t=Dt(";",!1),ft=Ut(["\r","\n"],!0,!1),pt=$t("variation"),gt=Dt("(",!1),dt=Dt(")",!1),St=$t("game termination marker"),mt=Dt("1-0",!1),Et=Dt("0-1",!1),bt=Dt("1/2-1/2",!1),vt=Dt("*",!1),At=$t("whitespace"),Ot=Ut([" ","\t","\r","\n"],!1,!1),Tt=function(t,e){return pgn(t,e)},Ct=function(t){return Object.fromEntries(t)},It=function(t,e){return[t,e]},kt=function(t,e){return{root:t,marker:e}},yt=function(t,e){return lineToTree(rootNode(t),...e.flat())},xt=function(t,e,r,i,n){return node(t,e,r,i,n)},Nt=function(t){return t},Pt=function(t){return t.replace(/[\r\n]+/g," ")},wt=function(t){return t.trim()},Kt=function(t){return t},Mt=function(t,e){return{result:t,comment:e}},Lt=0|e.peg$currPos,Rt=[{line:1,column:1}],Bt=Lt,Ft=e.peg$maxFailExpected||[],qt=0|e.peg$silentFails;if(e.startRule){if(!(e.startRule in h))throw new Error("Can't start parsing from rule \""+e.startRule+'".');l=h[e.startRule]}function Dt(t,e){return{type:"literal",text:t,ignoreCase:e}}function Ut(t,e,r){return{type:"class",parts:t,inverted:e,ignoreCase:r}}function $t(t){return{type:"other",description:t}}function Qt(e){var r,i=Rt[e];if(i)return i;if(e>=Rt.length)r=Rt.length-1;else for(r=e;!Rt[--r];);for(i={line:(i=Rt[r]).line,column:i.column};r<e;)10===t.charCodeAt(r)?(i.line++,i.column=1):i.column++,r++;return Rt[e]=i,i}function Gt(t,e,r){var i=Qt(t),n=Qt(e);return{source:a,start:{offset:t,line:i.line,column:i.column},end:{offset:e,line:n.line,column:n.column}}}function Ht(t){Lt<Bt||(Lt>Bt&&(Bt=Lt,Ft=[]),Ft.push(t))}function Wt(){var e,r;return e=function(){var t,e,r;t=Lt,e=[],r=Vt();for(;r!==o;)e.push(r),r=Vt();return r=Xt(),t=Ct(e),t}(),r=function(){var e,r,i;e=Lt,r=jt(),Xt(),i=function(){var e,r,i;qt++,e=Lt,t.substr(Lt,3)===T?(r=T,Lt+=3):(r=o,0===qt&&Ht(mt));r===o&&(t.substr(Lt,3)===C?(r=C,Lt+=3):(r=o,0===qt&&Ht(Et)),r===o&&(t.substr(Lt,7)===I?(r=I,Lt+=7):(r=o,0===qt&&Ht(bt)),r===o&&(42===t.charCodeAt(Lt)?(r=k,Lt++):(r=o,0===qt&&Ht(vt)))));r!==o?(Xt(),(i=Zt())===o&&(i=null),e=Mt(r,i)):(Lt=e,e=o);qt--,e===o&&(r=o,0===qt&&Ht(St));return e}(),i===o&&(i=null);return Xt(),e=kt(r,i),e}(),Tt(e,r)}function Vt(){var e,r,i,n,s,a,h;return qt++,e=Lt,Xt(),91===t.charCodeAt(Lt)?(r=u,Lt++):(r=o,0===qt&&Ht(q)),r!==o?(Xt(),i=function(){var e,r,i;qt++,e=Lt,r=[],i=t.charAt(Lt),y.test(i)?Lt++:(i=o,0===qt&&Ht(Q));if(i!==o)for(;i!==o;)r.push(i),i=t.charAt(Lt),y.test(i)?Lt++:(i=o,0===qt&&Ht(Q));else r=o;e=r!==o?t.substring(e,Lt):r;qt--,e===o&&(r=o,0===qt&&Ht($));return e}(),i!==o?(Xt(),34===t.charCodeAt(Lt)?(n=c,Lt++):(n=o,0===qt&&Ht(D)),n!==o?(s=function(){var e,r,i;qt++,e=Lt,r=[],i=t.charAt(Lt),x.test(i)?Lt++:(i=o,0===qt&&Ht(H));for(;i!==o;)r.push(i),i=t.charAt(Lt),x.test(i)?Lt++:(i=o,0===qt&&Ht(H));e=t.substring(e,Lt),qt--,r=o,0===qt&&Ht(G);return e}(),34===t.charCodeAt(Lt)?(a=c,Lt++):(a=o,0===qt&&Ht(D)),a!==o?(Xt(),93===t.charCodeAt(Lt)?(h=_,Lt++):(h=o,0===qt&&Ht(U)),h!==o?e=It(i,s):(Lt=e,e=o)):(Lt=e,e=o)):(Lt=e,e=o)):(Lt=e,e=o)):(Lt=e,e=o),qt--,e===o&&0===qt&&Ht(F),e}function jt(){var t,e,r;for((t=Zt())===o&&(t=null),e=[],r=Yt();r!==o;)e.push(r),r=Yt();return yt(t,e)}function Yt(){var e,r,i,n,s,a,h,l;if(e=Lt,Xt(),function(){var e,r,i,n,s,a;qt++,e=Lt,r=[],i=t.charAt(Lt),N.test(i)?Lt++:(i=o,0===qt&&Ht(V));for(;i!==o;)r.push(i),i=t.charAt(Lt),N.test(i)?Lt++:(i=o,0===qt&&Ht(V));46===t.charCodeAt(Lt)?(i=f,Lt++):(i=o,0===qt&&Ht(j));if(i!==o){for(n=Xt(),s=[],a=t.charAt(Lt),P.test(a)?Lt++:(a=o,0===qt&&Ht(Y));a!==o;)s.push(a),a=t.charAt(Lt),P.test(a)?Lt++:(a=o,0===qt&&Ht(Y));e=r=[r,i,n,s]}else Lt=e,e=o;qt--,e===o&&(r=o,0===qt&&Ht(W))}(),Xt(),r=function(){var e,r,i,n,s,a;qt++,e=Lt,r=Lt,t.substr(Lt,5)===p?(i=p,Lt+=5):(i=o,0===qt&&Ht(Z));if(i===o&&(t.substr(Lt,3)===g?(i=g,Lt+=3):(i=o,0===qt&&Ht(J)),i===o&&(t.substr(Lt,5)===d?(i=d,Lt+=5):(i=o,0===qt&&Ht(X)),i===o&&(t.substr(Lt,3)===S?(i=S,Lt+=3):(i=o,0===qt&&Ht(tt)),i===o))))if(i=Lt,n=t.charAt(Lt),y.test(n)?Lt++:(n=o,0===qt&&Ht(Q)),n!==o){if(s=[],a=t.charAt(Lt),w.test(a)?Lt++:(a=o,0===qt&&Ht(et)),a!==o)for(;a!==o;)s.push(a),a=t.charAt(Lt),w.test(a)?Lt++:(a=o,0===qt&&Ht(et));else s=o;s!==o?i=n=[n,s]:(Lt=i,i=o)}else Lt=i,i=o;i!==o?(n=t.charAt(Lt),K.test(n)?Lt++:(n=o,0===qt&&Ht(rt)),n===o&&(n=null),r=i=[i,n]):(Lt=r,r=o);e=r!==o?t.substring(e,Lt):r;qt--,e===o&&(r=o,0===qt&&Ht(z));return e}(),r!==o){for(i=function(){var e,r,i;qt++,e=Lt,r=[],i=t.charAt(Lt),M.test(i)?Lt++:(i=o,0===qt&&Ht(nt));for(;i!==o;)r.push(i),r.length>=2?i=o:(i=t.charAt(Lt),M.test(i)?Lt++:(i=o,0===qt&&Ht(nt)));r.length<1?(Lt=e,e=o):e=r;qt--,e===o&&(r=o,0===qt&&Ht(it));return e}(),i===o&&(i=null),n=[],s=zt();s!==o;)n.push(s),s=zt();for(s=Xt(),(a=Zt())===o&&(a=null),h=[],l=Jt();l!==o;)h.push(l),l=Jt();e=xt(r,i,n,a,h)}else Lt=e,e=o;return e}function zt(){var e,r,i,n,s;if(qt++,e=Lt,Xt(),36===t.charCodeAt(Lt)?(r=m,Lt++):(r=o,0===qt&&Ht(ot)),r!==o){if(i=Lt,n=[],s=t.charAt(Lt),N.test(s)?Lt++:(s=o,0===qt&&Ht(V)),s!==o)for(;s!==o;)n.push(s),s=t.charAt(Lt),N.test(s)?Lt++:(s=o,0===qt&&Ht(V));else n=o;(i=n!==o?t.substring(i,Lt):n)!==o?e=Nt(i):(Lt=e,e=o)}else Lt=e,e=o;return qt--,e===o&&0===qt&&Ht(st),e}function Zt(){var e;return(e=function(){var e,r,i,n,s;qt++,e=Lt,123===t.charCodeAt(Lt)?(r=E,Lt++):(r=o,0===qt&&Ht(ht));if(r!==o){for(i=Lt,n=[],s=t.charAt(Lt),L.test(s)?Lt++:(s=o,0===qt&&Ht(lt));s!==o;)n.push(s),s=t.charAt(Lt),L.test(s)?Lt++:(s=o,0===qt&&Ht(lt));i=t.substring(i,Lt),125===t.charCodeAt(Lt)?(n=b,Lt++):(n=o,0===qt&&Ht(ut)),n!==o?e=Pt(i):(Lt=e,e=o)}else Lt=e,e=o;qt--,e===o&&(r=o,0===qt&&Ht(at));return e}())===o&&(e=function(){var e,r,i,n,s;qt++,e=Lt,59===t.charCodeAt(Lt)?(r=v,Lt++):(r=o,0===qt&&Ht(_t));if(r!==o){for(i=Lt,n=[],s=t.charAt(Lt),R.test(s)?Lt++:(s=o,0===qt&&Ht(ft));s!==o;)n.push(s),s=t.charAt(Lt),R.test(s)?Lt++:(s=o,0===qt&&Ht(ft));i=t.substring(i,Lt),e=wt(i)}else Lt=e,e=o;qt--,e===o&&(r=o,0===qt&&Ht(ct));return e}()),e}function Jt(){var e,r,i,n;return qt++,e=Lt,Xt(),40===t.charCodeAt(Lt)?(r=A,Lt++):(r=o,0===qt&&Ht(gt)),r!==o&&(i=jt())!==o?(Xt(),41===t.charCodeAt(Lt)?(n=O,Lt++):(n=o,0===qt&&Ht(dt)),n!==o?e=Kt(i):(Lt=e,e=o)):(Lt=e,e=o),qt--,e===o&&0===qt&&Ht(pt),e}function Xt(){var e,r;for(qt++,e=[],r=t.charAt(Lt),B.test(r)?Lt++:(r=o,0===qt&&Ht(Ot));r!==o;)e.push(r),r=t.charAt(Lt),B.test(r)?Lt++:(r=o,0===qt&&Ht(Ot));return qt--,r=o,0===qt&&Ht(At),e}if(r=l(),e.peg$library)return{peg$result:r,peg$currPos:Lt,peg$FAILED:o,peg$maxFailExpected:Ft,peg$maxFailPos:Bt};if(r!==o&&Lt===t.length)return r;throw r!==o&&Lt<t.length&&Ht({type:"end"}),i=Ft,n=Bt<t.length?t.charAt(Bt):null,s=Bt<t.length?Gt(Bt,Bt+1):Gt(Bt,Bt),new peg$SyntaxError(peg$SyntaxError.buildMessage(i,n),i,n,s)}
/**
 * @license
 * Copyright (c) 2025, Jeff Hlywa (jhlywa@gmail.com)
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 * 1. Redistributions of source code must retain the above copyright notice,
 *    this list of conditions and the following disclaimer.
 * 2. Redistributions in binary form must reproduce the above copyright notice,
 *    this list of conditions and the following disclaimer in the documentation
 *    and/or other materials provided with the distribution.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
 * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
 * ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE
 * LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
 * CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
 * SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS
 * INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
 * CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)
 * ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
 * POSSIBILITY OF SUCH DAMAGE.
 */peg$subclass(peg$SyntaxError,Error),peg$SyntaxError.prototype.format=function(t){var e="Error: "+this.message;if(this.location){var r,i=null;for(r=0;r<t.length;r++)if(t[r].source===this.location.source){i=t[r].text.split(/\r\n|\n|\r/g);break}var n=this.location.start,s=this.location.source&&"function"==typeof this.location.source.offset?this.location.source.offset(n):n,o=this.location.source+":"+s.line+":"+s.column;if(i){var a=this.location.end,h=peg$padEnd("",s.line.toString().length," "),l=i[n.line-1],u=(n.line===a.line?a.column:l.length+1)-n.column||1;e+="\n --\x3e "+o+"\n"+h+" |\n"+s.line+" | "+l+"\n"+h+" | "+peg$padEnd("",n.column-1," ")+peg$padEnd("",u,"^")}else e+="\n at "+o}return e},peg$SyntaxError.buildMessage=function(t,e){var r={literal:function(t){return'"'+n(t.text)+'"'},class:function(t){var e=t.parts.map((function(t){return Array.isArray(t)?s(t[0])+"-"+s(t[1]):s(t)}));return"["+(t.inverted?"^":"")+e.join("")+"]"},any:function(){return"any character"},end:function(){return"end of input"},other:function(t){return t.description}};function i(t){return t.charCodeAt(0).toString(16).toUpperCase()}function n(t){return t.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(t){return"\\x0"+i(t)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(t){return"\\x"+i(t)}))}function s(t){return t.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(t){return"\\x0"+i(t)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(t){return"\\x"+i(t)}))}function o(t){return r[t.type](t)}return"Expected "+function(t){var e,r,i=t.map(o);if(i.sort(),i.length>0){for(e=1,r=1;e<i.length;e++)i[e-1]!==i[e]&&(i[r]=i[e],r++);i.length=r}switch(i.length){case 1:return i[0];case 2:return i[0]+" or "+i[1];default:return i.slice(0,-1).join(", ")+", or "+i[i.length-1]}}(t)+" but "+function(t){return t?'"'+n(t)+'"':"end of input"}(e)+" found."};const MASK64=0xffffffffffffffffn;function rotl(t,e){return 0xffffffffffffffffn&(t<<e|t>>64n-e)}function wrappingMul(t,e){return t*e&MASK64}function xoroshiro128(t){return function(){let e=BigInt(t&MASK64),r=BigInt(t>>64n&MASK64);const i=wrappingMul(rotl(wrappingMul(e,5n),7n),9n);return r^=e,e=(rotl(e,24n)^r^r<<16n)&MASK64,r=rotl(r,37n),t=r<<64n|e,i}}const rand=xoroshiro128(0xa187eb39cdcaed8f31c4b365b102e01en),PIECE_KEYS=Array.from({length:2},(()=>Array.from({length:6},(()=>Array.from({length:128},(()=>rand())))))),EP_KEYS=Array.from({length:8},(()=>rand())),CASTLING_KEYS=Array.from({length:16},(()=>rand())),SIDE_KEY=rand(),WHITE="w",BLACK="b",PAWN="p",KNIGHT="n",BISHOP="b",ROOK="r",QUEEN="q",KING="k",DEFAULT_POSITION="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1";class Move{color;from;to;piece;captured;promotion;flags;san;lan;before;after;constructor(t,e){const{color:r,piece:i,from:n,to:s,flags:o,captured:a,promotion:h}=e,l=algebraic(n),u=algebraic(s);this.color=r,this.piece=i,this.from=l,this.to=u,this.san=t._moveToSan(e,t._moves({legal:!0})),this.lan=l+u,this.before=t.fen(),t._makeMove(e),this.after=t.fen(),t._undoMove(),this.flags="";for(const t in BITS)BITS[t]&o&&(this.flags+=FLAGS[t]);a&&(this.captured=a),h&&(this.promotion=h,this.lan+=h)}isCapture(){return this.flags.indexOf(FLAGS.CAPTURE)>-1}isPromotion(){return this.flags.indexOf(FLAGS.PROMOTION)>-1}isEnPassant(){return this.flags.indexOf(FLAGS.EP_CAPTURE)>-1}isKingsideCastle(){return this.flags.indexOf(FLAGS.KSIDE_CASTLE)>-1}isQueensideCastle(){return this.flags.indexOf(FLAGS.QSIDE_CASTLE)>-1}isBigPawn(){return this.flags.indexOf(FLAGS.BIG_PAWN)>-1}}const EMPTY=-1,FLAGS={NORMAL:"n",CAPTURE:"c",BIG_PAWN:"b",EP_CAPTURE:"e",PROMOTION:"p",KSIDE_CASTLE:"k",QSIDE_CASTLE:"q",NULL_MOVE:"-"},SQUARES=["a8","b8","c8","d8","e8","f8","g8","h8","a7","b7","c7","d7","e7","f7","g7","h7","a6","b6","c6","d6","e6","f6","g6","h6","a5","b5","c5","d5","e5","f5","g5","h5","a4","b4","c4","d4","e4","f4","g4","h4","a3","b3","c3","d3","e3","f3","g3","h3","a2","b2","c2","d2","e2","f2","g2","h2","a1","b1","c1","d1","e1","f1","g1","h1"],BITS={NORMAL:1,CAPTURE:2,BIG_PAWN:4,EP_CAPTURE:8,PROMOTION:16,KSIDE_CASTLE:32,QSIDE_CASTLE:64,NULL_MOVE:128},SEVEN_TAG_ROSTER={Event:"?",Site:"?",Date:"????.??.??",Round:"?",White:"?",Black:"?",Result:"*"},SUPLEMENTAL_TAGS={WhiteTitle:null,BlackTitle:null,WhiteElo:null,BlackElo:null,WhiteUSCF:null,BlackUSCF:null,WhiteNA:null,BlackNA:null,WhiteType:null,BlackType:null,EventDate:null,EventSponsor:null,Section:null,Stage:null,Board:null,Opening:null,Variation:null,SubVariation:null,ECO:null,NIC:null,Time:null,UTCTime:null,UTCDate:null,TimeControl:null,SetUp:null,FEN:null,Termination:null,Annotator:null,Mode:null,PlyCount:null},HEADER_TEMPLATE={...SEVEN_TAG_ROSTER,...SUPLEMENTAL_TAGS},Ox88={a8:0,b8:1,c8:2,d8:3,e8:4,f8:5,g8:6,h8:7,a7:16,b7:17,c7:18,d7:19,e7:20,f7:21,g7:22,h7:23,a6:32,b6:33,c6:34,d6:35,e6:36,f6:37,g6:38,h6:39,a5:48,b5:49,c5:50,d5:51,e5:52,f5:53,g5:54,h5:55,a4:64,b4:65,c4:66,d4:67,e4:68,f4:69,g4:70,h4:71,a3:80,b3:81,c3:82,d3:83,e3:84,f3:85,g3:86,h3:87,a2:96,b2:97,c2:98,d2:99,e2:100,f2:101,g2:102,h2:103,a1:112,b1:113,c1:114,d1:115,e1:116,f1:117,g1:118,h1:119},PAWN_OFFSETS={b:[16,32,17,15],w:[-16,-32,-17,-15]},PIECE_OFFSETS={n:[-18,-33,-31,-14,18,33,31,14],b:[-17,-15,17,15],r:[-16,1,16,-1],q:[-17,-16,-15,1,17,16,15,-1],k:[-17,-16,-15,1,17,16,15,-1]},ATTACKS=[20,0,0,0,0,0,0,24,0,0,0,0,0,0,20,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,24,24,24,24,24,24,56,0,56,24,24,24,24,24,24,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,20,0,0,0,0,0,0,24,0,0,0,0,0,0,20],RAYS=[17,0,0,0,0,0,0,16,0,0,0,0,0,0,15,0,0,17,0,0,0,0,0,16,0,0,0,0,0,15,0,0,0,0,17,0,0,0,0,16,0,0,0,0,15,0,0,0,0,0,0,17,0,0,0,16,0,0,0,15,0,0,0,0,0,0,0,0,17,0,0,16,0,0,15,0,0,0,0,0,0,0,0,0,0,17,0,16,0,15,0,0,0,0,0,0,0,0,0,0,0,0,17,16,15,0,0,0,0,0,0,0,1,1,1,1,1,1,1,0,-1,-1,-1,-1,-1,-1,-1,0,0,0,0,0,0,0,-15,-16,-17,0,0,0,0,0,0,0,0,0,0,0,0,-15,0,-16,0,-17,0,0,0,0,0,0,0,0,0,0,-15,0,0,-16,0,0,-17,0,0,0,0,0,0,0,0,-15,0,0,0,-16,0,0,0,-17,0,0,0,0,0,0,-15,0,0,0,0,-16,0,0,0,0,-17,0,0,0,0,-15,0,0,0,0,0,-16,0,0,0,0,0,-17,0,0,-15,0,0,0,0,0,0,-16,0,0,0,0,0,0,-17],PIECE_MASKS={p:1,n:2,b:4,r:8,q:16,k:32},SYMBOLS="pnbrqkPNBRQK",PROMOTIONS=["n","b","r","q"],RANK_1=7,RANK_2=6,RANK_7=1,RANK_8=0,SIDES={[KING]:BITS.KSIDE_CASTLE,[QUEEN]:BITS.QSIDE_CASTLE},ROOKS={w:[{square:Ox88.a1,flag:BITS.QSIDE_CASTLE},{square:Ox88.h1,flag:BITS.KSIDE_CASTLE}],b:[{square:Ox88.a8,flag:BITS.QSIDE_CASTLE},{square:Ox88.h8,flag:BITS.KSIDE_CASTLE}]},SECOND_RANK={b:1,w:6},SAN_NULLMOVE="--";function rank(t){return t>>4}function file(t){return 15&t}function isDigit(t){return-1!=="0123456789".indexOf(t)}function algebraic(t){const e=file(t),r=rank(t);return"abcdefgh".substring(e,e+1)+"87654321".substring(r,r+1)}function swapColor(t){return"w"===t?"b":"w"}function validateFen(t){const e=t.split(/\s+/);if(6!==e.length)return{ok:!1,error:"Invalid FEN: must contain six space-delimited fields"};const r=parseInt(e[5],10);if(isNaN(r)||r<=0)return{ok:!1,error:"Invalid FEN: move number must be a positive integer"};const i=parseInt(e[4],10);if(isNaN(i)||i<0)return{ok:!1,error:"Invalid FEN: half move counter number must be a non-negative integer"};if(!/^(-|[abcdefgh][36])$/.test(e[3]))return{ok:!1,error:"Invalid FEN: en-passant square is invalid"};if(/[^kKqQ-]/.test(e[2]))return{ok:!1,error:"Invalid FEN: castling availability is invalid"};if(!/^(w|b)$/.test(e[1]))return{ok:!1,error:"Invalid FEN: side-to-move is invalid"};const n=e[0].split("/");if(8!==n.length)return{ok:!1,error:"Invalid FEN: piece data does not contain 8 '/'-delimited rows"};for(let t=0;t<n.length;t++){let e=0,r=!1;for(let i=0;i<n[t].length;i++)if(isDigit(n[t][i])){if(r)return{ok:!1,error:"Invalid FEN: piece data is invalid (consecutive number)"};e+=parseInt(n[t][i],10),r=!0}else{if(!/^[prnbqkPRNBQK]$/.test(n[t][i]))return{ok:!1,error:"Invalid FEN: piece data is invalid (invalid piece)"};e+=1,r=!1}if(8!==e)return{ok:!1,error:"Invalid FEN: piece data is invalid (too many squares in rank)"}}if("3"==e[3][1]&&"w"==e[1]||"6"==e[3][1]&&"b"==e[1])return{ok:!1,error:"Invalid FEN: illegal en-passant square"};const s=[{color:"white",regex:/K/g},{color:"black",regex:/k/g}];for(const{color:t,regex:r}of s){if(!r.test(e[0]))return{ok:!1,error:`Invalid FEN: missing ${t} king`};if((e[0].match(r)||[]).length>1)return{ok:!1,error:`Invalid FEN: too many ${t} kings`}}return Array.from(n[0]+n[7]).some((t=>"P"===t.toUpperCase()))?{ok:!1,error:"Invalid FEN: some pawns are on the edge rows"}:{ok:!0}}function getDisambiguator(t,e){const r=t.from,i=t.to,n=t.piece;let s=0,o=0,a=0;for(let t=0,h=e.length;t<h;t++){const h=e[t].from,l=e[t].to;n===e[t].piece&&r!==h&&i===l&&(s++,rank(r)===rank(h)&&o++,file(r)===file(h)&&a++)}return s>0?o>0&&a>0?algebraic(r):a>0?algebraic(r).charAt(1):algebraic(r).charAt(0):""}function addMove(t,e,r,i,n,s=void 0,o=BITS.NORMAL){const a=rank(i);if("p"!==n||7!==a&&0!==a)t.push({color:e,from:r,to:i,piece:n,captured:s,flags:o});else for(let a=0;a<PROMOTIONS.length;a++){const h=PROMOTIONS[a];t.push({color:e,from:r,to:i,piece:n,captured:s,promotion:h,flags:o|BITS.PROMOTION})}}function inferPieceType(t){let e=t.charAt(0);if(e>="a"&&e<="h"){if(t.match(/[a-h]\d.*[a-h]\d/))return;return"p"}return e=e.toLowerCase(),"o"===e?"k":e}function strippedSan(t){return t.replace(/=/,"").replace(/[+#]?[?!]*$/,"")}class Chess{_board=new Array(128);_turn="w";_header={};_kings={w:-1,b:-1};_epSquare=-1;_halfMoves=0;_moveNumber=0;_history=[];_comments={};_castli
